#!/bin/sh

# source debconf stuff
. /usr/share/debconf/confmodule

dbc_dbname=MCP
dbc_dbuser=archivematica

# source dbconfig-common shell library, and call the hook function
if [ -f /usr/share/dbconfig-common/dpkg/config.mysql ]; then
  . /usr/share/dbconfig-common/dpkg/config.mysql
  dbc_go archivematica-mcp-server $@
fi


userID=`id -u archivematica`

if [ "${userID}" = 333 ]; then
  echo "User archivematica exists"
else
  adduser --uid 333 --group --system --home /var/lib/archivematica/ archivematica
fi

sudo usermod -a -G audio archivematica
chown -R archivematica:archivematica "/var/archivematica/"
chmod -R g+s "/var/archivematica/"
chmod -R 775 "/var/archivematica/"
echo "archivematica ALL=NOPASSWD:/bin/mv,/bin/chown,/bin/chmod,/usr/bin/gs,/usr/lib/transcoder/transcoderScripts/DocumentConverter.py,/usr/bin/inkscape,/usr/lib/archivematica/transcoder/transcoderScripts/restartOpenOffice.sh" >> /etc/sudoers
chown archivematica:archivematica /etc/archivematica/MCPServer/dbsettings
chmod 700 /etc/archivematica/MCPServer/dbsettings
