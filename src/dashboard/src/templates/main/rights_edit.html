{% extends "layout_fluid.html" %}
{% load breadcumbs %}

{% block sidebar %}
  {% include sidebar_template %}
{% endblock %}

{% block js %}
  <script src="/media/js/rights_edit.js" type="text/javascript"></script>
  <script src="/media/vendor/jquery.inputmask.js" type="text/javascript"></script>
  <script type="text/javascript">

    $(document).ready(function()
      {

        $.extend($.inputmask.defaults.definitions, {
          'y': {
            'validator': '[012]\\d\\d\\d',
            'cardinality': 4,
            'prevalidator': [
              { 'validator': '[012]', 'cardinality': 1 }
            ]
          }
        });

        $('input[name*="date"]').inputmask('y/m/d');

      });

  </script>
{% endblock %}

{% block content %}
  <div class="row">
    <div class="span12">

      <ul class="breadcrumb">
        {% if section == 'ingest' %}
          {% breadcrumb_url 'Ingest' main.views.ingest_grid %}
          {% breadcrumb_url name main.views.ingest_detail uuid %}
        {% else %}
          {% breadcrumb_url 'Transfer' main.views.transfer_grid %}
          {% breadcrumb_url name main.views.transfer_detail uuid %}
        {% endif %}
        {% breadcrumb 'Rights' %}
      </ul>

      <h1>Rights<br /><small>{{ name }}</small></h1>

      {% if request.method == 'POST' %}
        {% if form.is_valid %}
          <div class="alert-message success">
            <p><strong>Saved!</p>
          </div>
        {% else %}
          <div class="alert-message error">
            <p>An error has occurred.</p>
          </div>
        {% endif %}
      {% endif %}

      {% if section == 'ingest' %}
        {% if id %}
          <form class="form-stacked" method="post" action="{% url main.views.ingest_rights_edit uuid id %}">
        {% else %}
          <form class="form-stacked" method="post" action="{% url main.views.ingest_rights_edit uuid %}">
        {% endif %}
      {% else %}
        {% if id %}
          <form class="form-stacked" method="post" action="{% url main.views.transfer_rights_edit uuid id %}">
        {% else %}
          <form class="form-stacked" method="post" action="{% url main.views.transfer_rights_edit uuid %}">
        {% endif %}
      {% endif %}

        {% include "_formset.html" with formset=grantFormset %}

        {% include "_form.html" %}

        <div id='copyright_formset'>
          {% include "_formset.html" with formset=copyrightFormset %}
          {% include "_formset_table.html" with formset=copyrightNoteFormset %}
        </div>

        <div id='statute_formset'>
          {% include "_formset.html" with formset=statuteFormset %}
          {% include "_formset_table.html" with formset=statuteNoteFormset %}
        </div>

        <div id='license_formset'>
          {% include "_formset.html" with formset=licenseFormset %}
          {% include "_formset_table.html" with formset=licenseNoteFormset %}
        </div>

        <div class="actions">
          {% if id %}
            <button type="submit" class="btn primary">Edit</button>
          {% else %}
            <button type="submit" class="btn primary">Add</button>
          {% endif %}

          {% if section == 'ingest' %}
            <a href="{% url main.views.ingest_rights_list uuid %}" class="btn">Cancel</a>
          {% else %}
             <a href="{% url main.views.transfer_rights_list uuid %}" class="btn">Cancel</a>
          {% endif %}
        </div>

      </form>
    </div>
  </div>

{% endblock %}
